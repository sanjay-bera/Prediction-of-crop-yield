<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crop Yield Prediction</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-image: url("{{ url_for('static', filename='bg-img.jpg') }}");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        background-attachment: fixed;
      }
      .container {
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 30px;
        padding: 30px;
        color: white;
        box-shadow: 0 4px 8px rgba(16, 15, 15, 0.22);
        backdrop-filter: blur(5px);
        width: 50%;
      }
      .form-control {
        border-radius: 10px;
        margin-bottom: 15px;
      }

      .btn-danger {
        border-radius: 10px;
        padding: 10px 30px;
      }
      h1 {
        font-family: "Roboto", sans-serif;
      }
      .prediction-result {
        background-color: rgba(255, 255, 255, 0.3);
        padding: 20px;
        border-radius: 10px;
        color: #007b2dff;
      }
    </style>
  </head>
  <body>
    <div class="container my-4 mt-4">
      <h1 class="text-center text-success mb-4">Crop Yield Prediction</h1>
      <h2 class="text-center text-danger mb-4">Input All Features Here</h2>

      <form action="/predict" method="post">
        
        <div class="form-group">
          <label for="Crop_Year">Year</label>
          <input
            type="number"
            class="form-control"
            name="Crop_Year"
            step="any"
            value="2025"
          />
        </div>

        <div class="form-group">
          <label for="Annual_Rainfall">Annual_Rainfall (mm per year)</label>
          <input
            type="number"
            class="form-control"
            name="Annual_Rainfall"
            step="any"
            value="{{ default_rainfall }}"
          />
        </div>

        <div class="form-group">
          <label for="Annual_Temperature">Average Temperature (Â°C)</label>
          <input
            type="number"
            class="form-control"
            name="Annual_Temperature"
            step="any"
            value="{{ default_temp }}"
          />
        </div>
        <div class="form-group">
          <label for="Pesticide">Pesticides (Tonnes)</label>
          <input
            type="number"
            class="form-control"
            name="Pesticide"
            step="any"
          />
        </div>
        <div class="form-group">
          <label for="Fertilizer">Fertilizer (Tonnes)</label>
          <input
            type="number"
            class="form-control"
            name="Fertilizer"
            step="any"
          />
        </div>
        <div class="form-group">
          <label for="Area">Area (Hectares)</label>
          <input type="number" class="form-control" name="Area" />
        </div>
        <div class="form-group">
          <label for="State">State</label>
          <select class="form-control" name="State" required>
            <option value="" disabled selected>Select a state</option>
            <option value="Andhra Pradesh">Andhra Pradesh</option>
            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
            <option value="Assam">Assam</option>
            <option value="Bihar">Bihar</option>
            <option value="Chhattisgarh">Chhattisgarh</option>
            <option value="Goa">Goa</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Haryana">Haryana</option>
            <option value="Himachal Pradesh">Himachal Pradesh</option>
            <option value="Jharkhand">Jharkhand</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Kerala">Kerala</option>
            <option value="Madhya Pradesh">Madhya Pradesh</option>
            <option value="Maharashtra">Maharashtra</option>
            <option value="Manipur">Manipur</option>
            <option value="Meghalaya">Meghalaya</option>
            <option value="Mizoram">Mizoram</option>
            <option value="Nagaland">Nagaland</option>
            <option value="Odisha">Odisha</option>
            <option value="Punjab">Punjab</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Sikkim">Sikkim</option>
            <option value="Tamil Nadu">Tamil Nadu</option>
            <option value="Telangana">Telangana</option>
            <option value="Tripura">Tripura</option>
            <option value="Uttar Pradesh">Uttar Pradesh</option>
            <option value="Uttarakhand">Uttarakhand</option>
            <option value="West Bengal">West Bengal</option>

            <!-- Optional: Union Territories -->
            <option value="Chandigarh">Chandigarh</option>
            <option value="Delhi">Delhi</option>
            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
            <option value="Ladakh">Ladakh</option>
            <option value="Lakshadweep">Lakshadweep</option>
            <option value="Puducherry">Puducherry</option>
          </select>
        </div>

        <div class="form-group">
          <label for="Crop">Crop Item</label>
          <select class="form-control narrow-select" name="Crop" required>
            <option value="" disabled selected>Select a crop</option>
            <option value="Arecanut">Arecanut</option>
            <option value="Potatoes">Potatoes</option>
            <option value="Wheat">Wheat</option>
            <option value="Rice, paddy">Rice, paddy</option>
            <option value="Sorghum">Sorghum</option>
            <option value="Cassava">Cassava</option>
            <option value="Soybeans">Soybeans</option>
            <option value="Sweet potatoes">Sweet potatoes</option>
            <option value="Yams">Yams</option>
            <option value="Plantains and others">Plantains and others</option>
          </select>
        </div>

        <div class="form-group">
          <label for="Season">Season</label>
          <select class="form-control" name="Season" required>
            <option value="" disabled selected>Select a season</option>
            <option value="Kharif">Kharif</option>
            <option value="Rabi">Rabi</option>
            <option value="Whole Year">Whole Year</option>
          </select>
        </div>

        <button type="submit" class="btn btn-danger btn-lg mt-2 btn-block">
          Predict
        </button>
      </form>

      {% if prediction %}
      <div class="prediction-result text-center mt-4">
        <h2>Predicted Yield: <br />{{prediction}} kg/ha</h2>
      </div>
      {% endif %}
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script>
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            // Call Flask backend to get weather
            fetch(`/get_weather?lat=${lat}&lon=${lon}`)
              .then((response) => response.json())
              .then((data) => {
                document.querySelector("input[name='avg_temp']").value =
                  data.temperature;
                document.querySelector(
                  "input[name='average_rain_fall_mm_per_year']"
                ).value = data.rainfall;
              })
              .catch((error) =>
                console.error("Error fetching weather:", error)
              );
          },
          function (error) {
            console.error("Location access denied or unavailable:", error);
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    </script>
  </body>
</html>
